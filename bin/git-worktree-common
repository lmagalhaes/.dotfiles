#!/usr/bin/env bash
# git-worktree-common - Shared functions and variables for git-worktree-* scripts
#
# This file should be sourced by other git-worktree-* scripts
# Usage: source "$(dirname "$0")/git-worktree-common"

# Exit on error, undefined variables, and pipe failures
set -euo pipefail

# Color definitions
export RED='\033[0;31m'
export GREEN='\033[0;32m'
export YELLOW='\033[1;33m'
export BLUE='\033[0;34m'
export CYAN='\033[0;36m'
export GRAY='\033[0;90m'
export NC='\033[0m' # No Color

# Helper functions for consistent output
error() {
    echo -e "${RED}Error: $1${NC}" >&2
    exit 1
}

info() {
    echo -e "${BLUE}→ $1${NC}"
}

success() {
    echo -e "${GREEN}✓ $1${NC}"
}

warning() {
    echo -e "${YELLOW}⚠ $1${NC}"
}

# Check if we're in a git repository
check_git_repo() {
    if ! git rev-parse --git-dir &>/dev/null; then
        error "Not in a git repository"
    fi
}

# Get repository root (works from both main repo and worktrees)
# Returns logical path (preserves symlinks)
get_repo_root() {
    dirname "$(git rev-parse --git-common-dir)"
}

# Get physical repository root (resolves symlinks)
get_repo_root_physical() {
    cd "$(dirname "$(git rev-parse --git-common-dir)")" && pwd -P
}

# Get logical repository root (preserves symlinks)
get_repo_root_logical() {
    cd "$(dirname "$(git rev-parse --git-common-dir)")" && pwd
}
